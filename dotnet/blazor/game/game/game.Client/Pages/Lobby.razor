@using Microsoft.AspNetCore.SignalR.Client
@using entities

@page "/"
@rendermode @(new InteractiveWebAssemblyRenderMode(prerender: false))

@inject NavigationManager NavigationManager

<h3>Lobby</h3>

<input tabindex="playerName" placeholder="your name" />
<input tabindex="roomName" placeholder="room name" />
<button @onclick="CreateRoom">Get Rooms</button>

@code {
    private HubConnection? hub;
    private string playerName = string.Empty;
    private string roomName = string.Empty;
    private GameRoom? room;
    private List<GameRoom> rooms = new();

    protected override async Task OnInitializedAsync()
    {
        hub = new HubConnectionBuilder().WithUrl(NavigationManager.ToAbsoluteUri("/gamehub"))
                                        .Build();

        hub.On<List<GameRoom>>("Rooms", (rooms) => { Console.WriteLine($"{rooms.Count} rooms."); });

        await hub.StartAsync();
    }

    private async Task CreateRoom()
    {
        if (hub is not null)
        {
            room = await hub.InvokeAsync<GameRoom>("CreateRoom", roomName, playerName);
        }
    }
}
